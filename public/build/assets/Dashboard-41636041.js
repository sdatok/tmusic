import{r,j as s,a as w}from"./app-d412d7ed.js";import{A as N}from"./AuthenticatedLayout-2f5acf6e.js";import{d as S}from"./PostItem-2d62b78c.js";import _ from"./PostList-8ae32206.js";import"./transition-acc08042.js";import"./tmusiclogo-591b3884.js";function T({auth:n,posts:x,spotify:P}){const[a,h]=r.useState(""),[p,f]=r.useState(""),[l,c]=r.useState([]),[o,u]=r.useState(null),[g,b]=r.useState(null);r.useEffect(()=>{fetch("/api/spotify-session").then(e=>e.json()).then(e=>{const t=new Date().getTime()/1e3;!e.spotify_access_token||t>e.spotify_token_expires?window.location.href="/authorize-spotify":(f(e.spotify_access_token),y(e.spotify_access_token))})},[]);const y=async e=>{try{const t=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch Spotify user profile");const i=await t.json();let m=null;i.images.length&&(m=i.images.reverse()[0].url,console.log(m),axios.post("/update-user-image",{profile_url:m})),axios.post("/update-user-name",{name:i.display_name}),b(i)}catch(t){console.error("Error fetching Spotify user profile:",t)}},d=async()=>{if(a.trim())try{const t=await(await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(a)}&type=track`,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"}})).json();c(t.tracks.items)}catch(e){console.error("Error fetching data:",e)}};r.useEffect(()=>{a!==""&&d()},[a,p]),r.useEffect(()=>{a===""&&c([])},[a]);const j=e=>{u({song_id:e.id,title:e.name,album:e.album.name,artist:e.artists.map(t=>t.name).join(", "),album_cover:e.album.images[0].url,user:n.user,preview_url:e.preview_url,description:""}),c([])},v=e=>{e.preventDefault(),S.Inertia.post("/posts",o).then(()=>{window.location.reload()})};return s.jsxs(N,{user:n.user,children:[s.jsx(w,{title:"Dashboard"}),s.jsx("div",{className:"md:ml-20 mx-auto px-8 py-8 ",children:s.jsxs("div",{className:"relative",children:[s.jsx("input",{className:"rounded-md border-2 border-gray-300 w-1/2 mr-2",placeholder:"Post a Song",type:"text",onKeyPress:e=>{e.key==="Enter"&&d()},onChange:e=>h(e.target.value)}),s.jsx("button",{className:"bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded",onClick:()=>{d()},children:"Search"})]})}),l.length>0&&s.jsx("div",{className:"container mx-auto px-4 mb-8 p-2",children:s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mx-2 overflow-y-auto h-56 md:h-96",children:l&&l.map((e,t)=>s.jsxs("div",{className:"bg-gray-200 rounded-lg max-w-xs shadow-lg cursor-pointer",onClick:()=>j(e),children:[s.jsx("img",{className:"w-full object-cover rounded-md",src:e.album.images[0].url,alt:e.name}),s.jsxs("div",{className:"px-4 py-2",children:[s.jsx("div",{className:"font-bold text-black text-lg line-clamp-1",children:e.name}),s.jsx("div",{className:"text-gray-600 text-sm line-clamp-1",children:e.artists.map(i=>i.name).join(", ")})]})]},t))})}),o&&s.jsx("div",{className:"px-6 md:px-12 md:w lg:px-32",children:s.jsxs("div",{className:"bg-midnight rounded-lg overflow-hidden shadow-lg relative mb-4 grid grid-cols-3",children:[s.jsx("div",{className:"col-span-2 p-4 flex flex-col justify-between",children:s.jsxs("form",{onSubmit:v,children:[s.jsx("div",{className:"text-white text-md font-bold truncate",children:o.title}),s.jsx("div",{className:"text-sm mb-2 text-gray-400 truncate",children:s.jsx("span",{className:"",children:o.artist})}),s.jsx("textarea",{className:"text-sm border-2 border-gray-300 w-full p-2 mb-2 rounded-lg",placeholder:"Description",value:o.description,onChange:e=>u({...o,description:e.target.value}),style:{resize:"none",height:"80px"}}),s.jsx("button",{type:"submit",className:"bg-blue-700 hover:bg-blue-700 text-white text-xs md:text-lg font-bold py-1 px-4 md:px-6 md:rounded-lg rounded",children:"Post"})]})}),s.jsx("div",{className:"col-span-1 flex justify-center items-center pr-4 md:p-4",children:s.jsx("img",{className:"rounded-lg aspect-w-1 aspect-h-1 w-full max-w-xs",src:o.album_cover,alt:o.title})})]})}),s.jsx(_,{posts:x,user:n.user,spotifyUserProfile:g})]})}export{T as default};
